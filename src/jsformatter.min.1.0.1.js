/*
JSFormatter - created by Miguel Ludert
https://github.com/thinkingsites/jsformatter

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

This package replicates the .Net formatting functionality.  
For full usage documentation refer here:
http://msdn.microsoft.com/en-us/library/26etazsy
*/
(function(){"use strict";if(typeof String.prototype.format==="undefined"){var a={padLeft:function(a,b,c){a=a.toString();while(a.length<c){a=b+a}return a},extend:function(){var a=arguments,b=a[0],c,d;for(c=1;c<a.length;c+=1){for(d in a[c]){if(a[c].hasOwnProperty(d)){b[d]=a[c][d]}}}return b},count:function(a,b,c){c=c===undefined?true:c;var d=0,e;for(e=0;e<b.length;e+=1){if(c&&b.charAt(e)==="\\"){e+=2}if(b.charAt(e)&&b.charAt(e)!==""&&a.indexOf(b.charAt(e))>-1){d+=1}}return d},regexLoop:function(a,b,c){var d;for(d=a.exec(b);d!==null;d=a.exec(b)){c(d)}},getProperties:function(a,b){var c=[],d,e;for(e in a){if(a.hasOwnProperty(e)){c.push(e)}}if(b){if(typeof b==="function"){d=b}else if(b==="length asc"){d=function(a,b){return a.length-b.length}}else if(b==="length desc"){d=function(a,b){return b.length-a.length}}c=c.sort(d)}return c},indexOf:function(a,b){var c=-1,d;if(typeof a.indexOf==="function"){c=a.indexOf(b)}else{for(d=0;d<a.length;d+=1){if(a[d]===b){c=d;break}}}return c},lastIndexOf:function(a,b){var c=-1,d;if(typeof a!=="undefined"){if(typeof a.lastIndexOf==="function"){c=a.lastIndexOf(b)}else{for(d=a.length-1;d>-1;d-=1){if(a[d]===b){c=d;break}}}}return c}},b=function(){};b.prototype={format:function(a,b){var c,d,e,f,g,h;if(b instanceof Date){a=a.length===1&&this.dateShorts.hasOwnProperty(a)?this.dateShorts[a]:a;c=[];for(d=0;d<a.length;d+=1){if(a.charAt(d)==="\\"){c.push(a.charAt(d+1));d+=1;continue}f=false;for(e=0;e<this.dateNames.length;e+=1){g=this.dateNames[e];if(a.substring(d,d+g.length)===g){c.push((this.date[g].apply(this,[b])||"").toString());d+=g.length-1;f=true;break}}if(f){continue}c.push(a.charAt(d))}c=c.join("")}else if(!isNaN(b)){if(b instanceof Number){b=b.valueOf()}else if(typeof b==="string"){b=parseFloat(b)}h=a.match(this.numberShortRegex);if(h){c=this.numberShorts[h[1].toLowerCase()].call(this,a,b,h[2]!==undefined?parseInt(h[2],10):undefined)}else{c=this.customNumberFormat(b,a)}}return c},customNumberFormat:function(b,c){var d=[],e=[],f,g=c.indexOf("."),h=c.substring(g+1),i=g>-1?c.substring(0,g):c,j=a.count("0#",h),k=i!==undefined&&i.replace(/,+$/).match(/\\?,/g),l=i===undefined||k===null?false:a.indexOf(k,",")>-1,m=0,n,o,p,q,r,s,t,u,v,w;if(c.indexOf("%")>-1){b=b*Math.pow(100,a.count("%",c))}if(c.indexOf("‰")>-1){b=b*Math.pow(1e3,a.count("‰",c))}k=i.match(/(\\?,)+$/);if(k&&k!==null){u=a.count(",",k[0],true);b=b/Math.pow(1e3,u)}b=b.toString();f=b.indexOf(".");n=f>-1?b.substring(f+1):undefined;o=f>-1?b.substring(0,f):b;if(g>-1){d.push(".");for(p=0;p<h.length;p+=1){if(h.charAt(p)==="\\"){d.push(h.charAt(p+1));p+=1}else if(h.charAt(p)==","){continue}else if(n!==undefined&&"0#".indexOf(h.charAt(p))>-1){if(m>=j-1){q=parseInt(n.charAt(m),10);if(!isNaN(q)){r=parseInt(n.substring(m+1,m+2),10);if(!isNaN(r)&&r>4){q+=1}d.push(q);m=n.length}}else if(n.length>m){d.push(n.charAt(m))}m+=1}else{d.push(h.charAt(p))}}k=h.match(/0|#/g);s=a.lastIndexOf(k,"0")+2;s=Math.max(s,0);if(d.length<s){s=s-d.length;d.push((new Array(s+1)).join("0"))}}else if(n!==undefined){o=Math.round(b).toString()}if(parseInt(o,10)>0){p=i.length-1;v=function(a,b){var c={formatComplete:a<=-1,valueComplete:m<=-1,isEscaped:b.charAt(a-1)=="\\",isComma:b.charAt(a)==",",isLiteral:"0#,.".indexOf(b.charAt(a))===-1};return c};for(m=o.length-1;m>-1;m-=1){for(w=v(p,i);!w.formatComplete&&(w.isEscaped||w.isLiteral||w.isComma);w=v(p,i)){if(w.isEscaped){e.unshift(i.charAt(p));p-=2}else if(!w.isLiteral||w.isComma){p-=1}else{e.unshift(i.charAt(p));p-=1}}e.unshift(o.charAt(m));p-=1;if(l&&m>0&&(o.length-m)%3==0){e.unshift(",")}}}if(p>-1){while(p>-1){if("#,".indexOf(i.charAt(p))==-1){e.unshift(i.charAt(p))}p-=1}}t=i.indexOf("0");t=t===-1?0:i.length-t;while(e.length<t){e.unshift("0")}return e.join("")+d.join("")},standardNumberFormat:function(b,c){c=a.extend({prefix:"",seperator:"",seperateAt:0,places:undefined,suffix:undefined,pad:undefined},c);var d=[b>0?"":"-",c.prefix],e,f,g;b=Math.abs(b);b=c.places!==undefined?parseFloat(b).toFixed(c.places):b.toString();b=c.pad?a.padLeft(b,"0",c.pad):b;if(c.seperateAt>0){e=b.lastIndexOf(".");e=e===-1?b.length:e;f=e%c.seperateAt;for(g=0;g<e;g+=1){if(g!==0&&g%c.seperateAt===f){d.push(c.seperator)}d.push(b.charAt(g))}for(g=e;g<b.length;g+=1){d.push(b.charAt(g))}}else{d.push(b)}if(c.suffix){d.push(c.suffix)}return d.join("")},numberShorts:{c:function(a,b,c){return this.standardNumberFormat(b,{prefix:"$",seperator:",",seperateAt:3,places:isNaN(c)?2:c})},d:function(a,b,c){return this.standardNumberFormat(b,{places:0,pad:c})},e:function(a,b,c){return b.toExponential(isNaN(c)?6:c).toString().toUpperCase()},f:function(a,b,c){return this.standardNumberFormat(b,{places:isNaN(c)?2:c})},g:function(a,b,c){var d,e=isNaN(c),f=b.toExponential(c).toString(),g=f.match(/[\-+]\d+$/);f=parseInt(g[0],10);if(f>-5&&(e||f<c)){d=e?b.toString():b.toPrecision(c)}else{d=b.toExponential(e?1:Math.max(c-1,0))}return d.toString().toUpperCase()},n:function(a,b,c){return this.standardNumberFormat(b,{seperator:",",seperateAt:3,places:isNaN(c)?2:c})},r:function(a,b,c){return b.toString()},x:function(b,c,d){var e=c>0?"":"-",f;c=Math.abs(c.toString(16));if(isNaN(c)){f=c}else{f=e+a.padLeft(c,"0",d||0)}return f}},date:{dd:function(a){return a.getDate()},ddd:function(a){return this.daysShort[a.getDay()]},dddd:function(a){return this.days[a.getDay()]},hh:function(a){var b=a.getHours();if(b>12){b-=12}return b},HH:function(a){return a.getHours()},mm:function(a){return a.getMinutes()},MM:function(a){return a.getMonth()+1},MMM:function(a){return this.monthsShort[a.getMonth()]},MMMM:function(a){return this.months[a.getMonth()]},ss:function(a){return a.getSeconds()},tt:function(a){return a.getHours()>11?"PM":"AM"},yy:function(a){return a.getFullYear().toString().substring(2)},yyyy:function(a){return a.getFullYear()},zz:function(b){var c=b.getTimezoneOffset(),d=(c>0?"-":"")+a.padLeft(Math.abs(Math.floor(c/60)),"0",2).toString();return d},zzz:function(b){var c=b.getTimezoneOffset(),d=(c>0?"-":"")+a.padLeft(Math.abs(Math.floor(c/60)),"0",2).toString()+":"+a.padLeft(c%60,"0",2);return d}},dateShorts:{d:"dd/MM/yyyy",D:"MMMM dd, yyyy",t:"hh:mm tt",T:"hh:mm:ss tt",f:"MMMM dd, yyyy hh:mm tt",F:"MMMM dd, yyyy hh:mm:ss tt",g:"dd/MM/yyyy hh:mm tt",G:"dd/MM/yyyy hh:mm:ss tt",M:"MMMM dd",r:"ddd, dd MMM yyyy hh:mm:ss GMT",s:"yyyy-MM-ddThh:mm:ss",u:"yyyy-MM-dd hh:mm:ssZ",U:"MMMM dd,yyyy hh:mm:ss tt",Y:"MMMM, yyyy"},days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};b.prototype.dateNames=function(){return a.getProperties(b.prototype.date,"length desc")}();b.prototype.numberShortRegex=function(){var c=a.getProperties(b.prototype.numberShorts,"length desc");return new RegExp("^(["+c.join("")+"])(\\d+)?$","i")}();String.prototype.format=function(){var a=this,c=[],d=[],e=0,f,g,h,i,j,k,l=function(a,b,c,d){if(c){var e;for(e=0;e<Math.abs(a)-b.length;e+=1){d.push(" ")}}};if(a.indexOf("{{")===-1&&a.indexOf("}}")-1){f=/\{(\d+)(,-?\d+)?(:.*?)?\}/gi;for(g=f.exec(a);g!==null;g=f.exec(a)){d.push({length:g[0].length,index:g[1],padding:g[2]!==undefined?parseInt(g[2].substring(1),10):0,format:g[3]!==undefined?g[3].substring(1):undefined,value:arguments[g[1]],paramAt:g.index})}}else{f=/^(\d+)(,-?\d+)?(:.*?)?$/gi;j=0;while(j>-1){h=a.indexOf("{",j);while(h!==-1&&a.substring(h,h+2)==="{{"){h=a.indexOf("{",h+2)}i=a.indexOf("}",j);while(i!==-1&&a.substring(i,i+2)==="}}"){i=a.indexOf("}",i+2)}if(h!==-1&&i!==-1){g=a.substring(h+1,i);g=f.exec(g);d.push({match:g[0].length+2,index:g[1],padding:g[2]!==undefined?parseInt(g[2].substring(1),10):0,format:g[3]!==undefined?g[3].substring(1):undefined,value:arguments[g[1]],paramAt:h})}j=a.indexOf("{",i)}}for(j=0;j<d.length;j+=1){k=d[j];if(k.paramAt>e){c.push(a.substring(e,k.paramAt));e=k.paramAt}if(k.format){k.value=(new b).format(k.format,k.value)}l(k.padding,k.value,k.padding<0,c);c.push(k.value);e+=k.length;l(k.padding,k.value,k.padding>0,c)}if(e<a.length){c.push(a.substring(e,a.length))}c=c.join("");return c};Number.prototype.format=function(a){return(new b).format(a,this)};Date.prototype.format=function(a){return(new b).format(a,this)};String.format=function(a){var b=[],c;for(c=1;c<arguments.length;c++){b.push(arguments[c])}return String.prototype.format.apply(a,b)}}})()