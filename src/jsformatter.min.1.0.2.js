/*
JSFormatter - created by Miguel Ludert
https://github.com/thinkingsites/jsformatter

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

This package replicates and extends the .Net formatting functionality.  
For full usage documentation refer here:
http://msdn.microsoft.com/en-us/library/26etazsy
*/
(function(){"use strict";var e,t,n,r={isNullOrUndefined:function(e){return typeof e==="undefined"||e===null},numberToString:function(e){var t,n,r,i=e.toString();if(i.indexOf("e")>-1){n=i.match(/\d+$/);if(i.indexOf("e-")>-1){t=e.toFixed(Math.min(n))}else{r=i.match(/^-?\d+(\.\d+)?/)[0].replace(/\./,"");t=r+(new Array(n-r.length+2)).join("0")}}else{t=i}return t},extend:function(){var e=arguments,t=e[0],n,r;for(n=1;n<e.length;n+=1){for(r in e[n]){if(e[n].hasOwnProperty(r)){t[r]=e[n][r]}}}return t},pad:function(e,t,n,i){var s=r.isArray(e),o=s?e.slice(0):[e],u=o.join("").length;n=Math.abs(n);if(u<n){o[i>0?"push":"unshift"]((new Array(n-u+1)).join(t))}return s?o:o.join("")},count:function(e,t,n){if(!e)return 0;n=n===undefined?true:n;var r=0,i;for(i=0;i<e.length;i+=1){if(n&&e.charAt(i)==="\\"){i+=2}if(e.charAt(i)&&e.charAt(i)!==""&&t.indexOf(e.charAt(i))>-1){r+=1}}return r},regexLoop:function(e,t,n){var r;for(r=e.exec(t);r!==null;r=e.exec(t)){n(r)}},getProperties:function(e,t){var n=[],r,i;for(i in e){if(e.hasOwnProperty(i)){n.push(i)}}if(t){if(typeof t==="function"){r=t}else if(t==="length asc"){r=function(e,t){return e.length-t.length}}else if(t==="length desc"){r=function(e,t){return t.length-e.length}}n=n.sort(r)}return n},indexOf:function(e,t){var n=-1,r;if(typeof e.indexOf==="function"){n=e.indexOf(t)}else{for(r=0;r<e.length;r+=1){if(e[r]===t){n=r;break}}}return n},lastIndexOf:function(e,t){var n=-1,r;if(typeof e!=="undefined"){if(typeof e.lastIndexOf==="function"){n=e.lastIndexOf(t)}else{for(r=e.length-1;r>-1;r-=1){if(e[r]===t){n=r;break}}}}return n},isNumber:function(e){return Object.prototype.toString.call(e)=="[object Number]"},isFunction:function(e){return typeof e==="function"},isDate:function(e){return Object.prototype.toString.call(e)=="[object Date]"},isString:function(e){return Object.prototype.toString.call(e)=="[object String]"},isObject:function(e){var t={"boolean":false,"function":true,object:true,number:false,string:false,"undefined":false};return!!(e&&t[typeof e])},isArray:function(e){return e instanceof Array},makeArray:function(e){var t,n=[];try{n=Array.prototype.slice.call(e)}catch(r){if(e&&e.length){for(t=0;t<e.length;t+=1){n.push(e[t])}}}return n}};t=function(){var e,t,n;e=function(){};e.prototype={format:function(e,t){var n,i,s,o,u,a;if(r.isFunction(t)){t=t()}if(r.isDate(t)){e=e.length===1&&this.dateShorts.hasOwnProperty(e)?this.dateShorts[e]:e;n=[];for(i=0;i<e.length;i+=1){if(e.charAt(i)==="\\"){n.push(e.charAt(i+1));i+=1;continue}o=false;for(s=0;s<this.dateNames.length;s+=1){u=this.dateNames[s];if(e.substring(i,i+u.length)===u){n.push((this.date[u].apply(this,[t])||"").toString());i+=u.length-1;o=true;break}}if(o){continue}n.push(e.charAt(i))}n=n.join("")}else if(!isNaN(t)){if(r.isNumber(t)){t=t.valueOf()}else if(r.isString(t)){t=parseFloat(t)}a=e.match(this.numberShortRegex);if(a){n=this.numberShorts[a[1].toLowerCase()].call(this,e,t,a[2]!==undefined?parseInt(a[2],10):undefined)}else{n=this.customNumberFormat(t,e)}}return n},customNumberFormat:function(e,t){var n=e,i=[],s=[],o,u=t.indexOf("."),a=u>-1?t.substring(u+1):undefined,f=u>-1?t.substring(0,u):t,l=r.count(a,"0#"),c=f!==undefined&&f.replace(/,+$/).match(/\\?,/g),h=f===undefined||c===null?false:r.indexOf(c,",")>-1,p=a?r.lastIndexOf(a,"0"):0,d=a?r.indexOf(a,"#"):0,v=f?r.indexOf(f,"0"):0,m=f?r.lastIndexOf(f,"#"):0,g=0,y,b,w,E,S,x,T,N,C,k;if(a&&p>d){a=a.slice(0,p).replace(/#/g,"0")+a.slice(p,a.length)}if(f&&m<v){f=f.slice(0,v)+f.slice(v,f.length).replace(/#/g,"0")}if(t.indexOf("%")>-1){e=e*Math.pow(100,r.count(t,"%"))}if(t.indexOf("‰")>-1){e=e*Math.pow(1e3,r.count(t,"‰"))}c=f.match(/(\\?,)+$/);if(c&&c!==null){N=r.count(c[0],",",true);e=e/Math.pow(1e3,N)}e=new Number(e.toFixed(l));e=r.numberToString(e);o=e.indexOf(".");y=o>-1?e.substring(o+1):undefined;b=o>-1?e.substring(0,o):e;if(a){if(y&&d>-1||p>-1)i.push(".");for(w=0;w<a.length;w+=1){if(a.charAt(w)==="\\"){i.push(a.charAt(w+1));w+=1}else if(a.charAt(w)==","){continue}else if("0#".indexOf(a.charAt(w))>-1){if(typeof y==="undefined"){if(a.charAt(w)==0){i.push(0)}else{break}}else if(g>=l-1){E=parseInt(y.charAt(g),10);if(!isNaN(E)){S=parseInt(y.substring(g+1,g+2),10);if(!isNaN(S)&&S>4){E+=1}i.push(E);g=y.length}}else if(y.length>g){i.push(y.charAt(g))}g+=1}else{i.push(a.charAt(w))}}c=a.match(/0/g);if(c){x=r.lastIndexOf(c,"0")+2;x=Math.max(x,0);i=r.pad(i,"0",x,1)}}else if(y!==undefined){b=Math.round(e).toString()}w=f.length-1;C=function(e,t,n){var r={formatComplete:t<=-1,valueComplete:e<=-1,isEscaped:n.charAt(t-1)=="\\",isComma:n.charAt(t)==",",isLiteral:"0#,.".indexOf(n.charAt(t))===-1};return r};for(g=b.length-1;g>-1;g-=1){for(k=C(g,w,f);!k.formatComplete&&(k.isEscaped||k.isLiteral||k.isComma);k=C(g,w,f)){if(k.isEscaped){s.unshift(f.charAt(w));w-=2}else if(!k.isLiteral||k.isComma){w-=1}else{s.unshift(f.charAt(w));w-=1}}if(f.replace(/#/g,"").length>0||parseInt(e)>0||parseFloat(e)<0){s.unshift(b.charAt(g));w-=1}if(h&&g>0&&(b.length-g)%3==0){s.unshift(",")}}if(w>-1){while(w>-1){if("#,".indexOf(f.charAt(w))==-1){s.unshift(f.charAt(w))}w-=1}}T=f.indexOf("0");T=T===-1?0:f.length-T;s=r.pad(s,"0",T,-1);return s.join("")+i.join("")},standardNumberFormat:function(e,t){t=r.extend({prefix:"",seperator:"",seperateAt:0,places:undefined,suffix:undefined,pad:undefined},t);var n=[e>0?"":"-",t.prefix],i,s,o;e=Math.abs(e);e=t.places!==undefined?parseFloat(e).toFixed(t.places):e.toString();e=t.pad?r.pad(e,"0",t.pad,-1):e;if(t.seperateAt>0){i=e.lastIndexOf(".");i=i===-1?e.length:i;s=i%t.seperateAt;for(o=0;o<i;o+=1){if(o!==0&&o%t.seperateAt===s){n.push(t.seperator)}n.push(e.charAt(o))}for(o=i;o<e.length;o+=1){n.push(e.charAt(o))}}else{n.push(e)}if(t.suffix){n.push(t.suffix)}return n.join("")},numberShorts:{c:function(e,t,n){return this.standardNumberFormat(t,{prefix:"$",seperator:",",seperateAt:3,places:isNaN(n)?2:n})},d:function(e,t,n){return this.standardNumberFormat(t,{places:0,pad:n})},e:function(e,t,n){return t.toExponential(isNaN(n)?6:n).toString().toUpperCase()},f:function(e,t,n){return this.standardNumberFormat(t,{places:isNaN(n)?2:n})},g:function(e,t,n){var r,i=isNaN(n),s=t.toExponential(n).toString(),o=s.match(/[\-+]\d+$/);s=parseInt(o[0],10);if(s>-5&&(i||s<n)){r=i?t.toString():t.toPrecision(n)}else{r=t.toExponential(i?1:Math.max(n-1,0))}return r.toString().toUpperCase()},n:function(e,t,n){return this.standardNumberFormat(t,{seperator:",",seperateAt:3,places:isNaN(n)?2:n})},r:function(e,t,n){return t.toString()},x:function(e,t,n){var i=t>0?"":"-",s;t=Math.abs(t.toString(16));if(isNaN(t)){s=t}else{s=i+r.pad(t,"0",n||0,-1)}return s}},date:{dd:function(e){return e.getDate()},ddd:function(e){return this.daysShort[e.getDay()]},dddd:function(e){return this.days[e.getDay()]},hh:function(e){var t=e.getHours();if(t>12){t-=12}return r.pad(t,"0",2,-1)},HH:function(e){return r.pad(e.getHours(),"0",2,-1)},mm:function(e){return r.pad(e.getMinutes(),"0",2,-1)},MM:function(e){return e.getMonth()+1},MMM:function(e){return this.monthsShort[e.getMonth()]},MMMM:function(e){return this.months[e.getMonth()]},ss:function(e){return r.pad(e.getSeconds(),"0",2,-1)},tt:function(e){return e.getHours()>11?"PM":"AM"},yy:function(e){return e.getFullYear().toString().substring(2)},yyyy:function(e){return e.getFullYear()},zz:function(e){var t=e.getTimezoneOffset(),n=(t>0?"-":"")+r.pad(Math.abs(Math.floor(t/60)),"0",2,-1).toString();return n},zzz:function(e){var t=e.getTimezoneOffset(),n=(t>0?"-":"")+r.pad(Math.abs(Math.floor(t/60)),"0",2,-1).toString()+":"+r.pad(t%60,"0",2,-1);return n}},dateShorts:{d:"dd/MM/yyyy",D:"MMMM dd, yyyy",t:"hh:mm tt",T:"hh:mm:ss tt",f:"MMMM dd, yyyy hh:mm tt",F:"MMMM dd, yyyy hh:mm:ss tt",g:"dd/MM/yyyy hh:mm tt",G:"dd/MM/yyyy hh:mm:ss tt",M:"MMMM dd",r:"ddd, dd MMM yyyy hh:mm:ss GMT",s:"yyyy-MM-ddThh:mm:ss",u:"yyyy-MM-dd hh:mm:ssZ",U:"MMMM dd,yyyy hh:mm:ss tt",Y:"MMMM, yyyy"},days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};e.prototype.dateNames=function(){return r.getProperties(e.prototype.date,"length desc")}();e.prototype.numberShortRegex=function(){var t=r.getProperties(e.prototype.numberShorts,"length desc");return new RegExp("^(["+t.join("")+"])(\\d+)?$","i")}();t=function(t,n){var i=t,s=[],o=[],u=0,a,f,l,c,h,p,d=function(e){return r.isFunction(e)?e():e};if(r.isFunction(n)){n=n()}if(r.isDate(n)||!r.isObject(n)&&!r.isArray(n)){n=r.makeArray(arguments).slice(1)}if(i.indexOf("{{")===-1&&i.indexOf("}}")===-1){a=/\{(\w+)(,-?\d+)?(:.*?)?\}/gi;for(f=a.exec(i);f!==null;f=a.exec(i)){o.push({length:f[0].length,index:f[1],padding:f[2]!==undefined?parseInt(f[2].substring(1),10):0,format:f[3]!==undefined?f[3].substring(1):undefined,value:d(n[f[1]]),paramAt:f.index})}}else{a=/^(\d+)(,-?\d+)?(:.*?)?$/gi;h=0;while(h>-1){l=i.indexOf("{",h);while(l!==-1&&i.substring(l,l+2)==="{{"){l=i.indexOf("{",l+2)}c=i.indexOf("}",h);while(c!==-1&&i.substring(c,c+2)==="}}"){c=i.indexOf("}",c+2)}if(l!==-1&&c!==-1){f=i.substring(l+1,c);f=a.exec(f);o.push({match:f[0].length+2,index:f[1],padding:f[2]!==undefined?parseInt(f[2].substring(1),10):0,format:f[3]!==undefined?f[3].substring(1):undefined,value:d(n[f[1]]),paramAt:l})}h=i.indexOf("{",c)}}for(h=0;h<o.length;h+=1){p=o[h];if(p.paramAt>u){s.push(i.substring(u,p.paramAt));u=p.paramAt}if(p.format&&(r.isDate(p.value)||r.isNumber(p.value))){p.value=(new e).format(p.format,p.value)}p.value=r.pad(p.value," ",p.padding,p.padding);s.push(p.value);u+=p.length}if(u<i.length){s.push(i.substring(u,i.length))}s=s.join("");return s};n={format:t,formatValue:function(t,n){return(new e).format(t,n)}};return n};n=t();e={asPrototype:true,asGlobal:"formatter"};if(typeof formatConfig!=="undefined"&&formatConfig.hasOwnProperty){r.extend(e,formatConfig)}if(e.asPrototype){String.prototype.format=function(){var e=r.makeArray(arguments);return n.format(this,e)};Number.prototype.format=function(e){return n.formatValue(e,this)};Date.prototype.format=function(e){return n.formatValue(e,this)}}if(typeof e.asGlobal==="string"){window[e.asGlobal]=n}if(typeof define==="function"&&define.amd){define("jsformatter",function(){return n})}else if(typeof module!=="undefined"){module.exports=n;this._=n}})()