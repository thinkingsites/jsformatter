/*
JSFormatter - created by Miguel Ludert
https://github.com/thinkingsites/jsformatter

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

This package replicates the .Net formatting functionality.  
For full usage documentation refer here:
http://msdn.microsoft.com/en-us/library/26etazsy
*/
(function(){"use strict";var a,b,c,d={extend:function(){var a=arguments,b=a[0],c,d;for(c=1;c<a.length;c+=1){for(d in a[c]){if(a[c].hasOwnProperty(d)){b[d]=a[c][d]}}}return b},pad:function(a,b,c,e){var f=d.isArray(a),g=f?a.slice(0):[a],h=g.join("").length;c=Math.abs(c);if(h<c){g[e>0?"push":"unshift"]((new Array(c-h+1)).join(b))}return f?g:g.join("")},count:function(a,b,c){c=c===undefined?true:c;var d=0,e;for(e=0;e<b.length;e+=1){if(c&&b.charAt(e)==="\\"){e+=2}if(b.charAt(e)&&b.charAt(e)!==""&&a.indexOf(b.charAt(e))>-1){d+=1}}return d},regexLoop:function(a,b,c){var d;for(d=a.exec(b);d!==null;d=a.exec(b)){c(d)}},getProperties:function(a,b){var c=[],d,e;for(e in a){if(a.hasOwnProperty(e)){c.push(e)}}if(b){if(typeof b==="function"){d=b}else if(b==="length asc"){d=function(a,b){return a.length-b.length}}else if(b==="length desc"){d=function(a,b){return b.length-a.length}}c=c.sort(d)}return c},indexOf:function(a,b){var c=-1,d;if(typeof a.indexOf==="function"){c=a.indexOf(b)}else{for(d=0;d<a.length;d+=1){if(a[d]===b){c=d;break}}}return c},lastIndexOf:function(a,b){var c=-1,d;if(typeof a!=="undefined"){if(typeof a.lastIndexOf==="function"){c=a.lastIndexOf(b)}else{for(d=a.length-1;d>-1;d-=1){if(a[d]===b){c=d;break}}}}return c},isArray:function(a){return a instanceof Array},makeArray:function(a){var b,c=[];try{c=Array.prototype.slice.call(a)}catch(d){if(a&&a.length){for(b=0;b<a.length;b+=1){c.push(a[b])}}}return c}};b=function(){var a,b,c;a=function(){};a.prototype={format:function(a,b){var c,d,e,f,g,h;if(b instanceof Date){a=a.length===1&&this.dateShorts.hasOwnProperty(a)?this.dateShorts[a]:a;c=[];for(d=0;d<a.length;d+=1){if(a.charAt(d)==="\\"){c.push(a.charAt(d+1));d+=1;continue}f=false;for(e=0;e<this.dateNames.length;e+=1){g=this.dateNames[e];if(a.substring(d,d+g.length)===g){c.push((this.date[g].apply(this,[b])||"").toString());d+=g.length-1;f=true;break}}if(f){continue}c.push(a.charAt(d))}c=c.join("")}else if(!isNaN(b)){if(b instanceof Number){b=b.valueOf()}else if(typeof b==="string"){b=parseFloat(b)}h=a.match(this.numberShortRegex);if(h){c=this.numberShorts[h[1].toLowerCase()].call(this,a,b,h[2]!==undefined?parseInt(h[2],10):undefined)}else{c=this.customNumberFormat(b,a)}}return c},customNumberFormat:function(a,b){var c=[],e=[],f,g=b.indexOf("."),h=b.substring(g+1),i=g>-1?b.substring(0,g):b,j=d.count("0#",h),k=i!==undefined&&i.replace(/,+$/).match(/\\?,/g),l=i===undefined||k===null?false:d.indexOf(k,",")>-1,m=0,n,o,p,q,r,s,t,u,v,w;if(b.indexOf("%")>-1){a=a*Math.pow(100,d.count("%",b))}if(b.indexOf("‰")>-1){a=a*Math.pow(1e3,d.count("‰",b))}k=i.match(/(\\?,)+$/);if(k&&k!==null){u=d.count(",",k[0],true);a=a/Math.pow(1e3,u)}a=a.toString();f=a.indexOf(".");n=f>-1?a.substring(f+1):undefined;o=f>-1?a.substring(0,f):a;if(g>-1){c.push(".");for(p=0;p<h.length;p+=1){if(h.charAt(p)==="\\"){c.push(h.charAt(p+1));p+=1}else if(h.charAt(p)==","){continue}else if("0#".indexOf(h.charAt(p))>-1){if(typeof n==="undefined"){c.push(0)}else if(m>=j-1){q=parseInt(n.charAt(m),10);if(!isNaN(q)){r=parseInt(n.substring(m+1,m+2),10);if(!isNaN(r)&&r>4){q+=1}c.push(q);m=n.length}}else if(n.length>m){c.push(n.charAt(m))}m+=1}else{c.push(h.charAt(p))}}k=h.match(/0|#/g);s=d.lastIndexOf(k,"0")+2;s=Math.max(s,0);c=d.pad(c,"0",s,1)}else if(n!==undefined){o=Math.round(a).toString()}if(parseInt(o,10)>0){p=i.length-1;v=function(a,b){var c={formatComplete:a<=-1,valueComplete:m<=-1,isEscaped:b.charAt(a-1)=="\\",isComma:b.charAt(a)==",",isLiteral:"0#,.".indexOf(b.charAt(a))===-1};return c};for(m=o.length-1;m>-1;m-=1){for(w=v(p,i);!w.formatComplete&&(w.isEscaped||w.isLiteral||w.isComma);w=v(p,i)){if(w.isEscaped){e.unshift(i.charAt(p));p-=2}else if(!w.isLiteral||w.isComma){p-=1}else{e.unshift(i.charAt(p));p-=1}}e.unshift(o.charAt(m));p-=1;if(l&&m>0&&(o.length-m)%3==0){e.unshift(",")}}}if(p>-1){while(p>-1){if("#,".indexOf(i.charAt(p))==-1){e.unshift(i.charAt(p))}p-=1}}t=i.indexOf("0");t=t===-1?0:i.length-t;e=d.pad(e,"0",t,-1);return e.join("")+c.join("")},standardNumberFormat:function(a,b){b=d.extend({prefix:"",seperator:"",seperateAt:0,places:undefined,suffix:undefined,pad:undefined},b);var c=[a>0?"":"-",b.prefix],e,f,g;a=Math.abs(a);a=b.places!==undefined?parseFloat(a).toFixed(b.places):a.toString();a=b.pad?d.pad(a,"0",b.pad,-1):a;if(b.seperateAt>0){e=a.lastIndexOf(".");e=e===-1?a.length:e;f=e%b.seperateAt;for(g=0;g<e;g+=1){if(g!==0&&g%b.seperateAt===f){c.push(b.seperator)}c.push(a.charAt(g))}for(g=e;g<a.length;g+=1){c.push(a.charAt(g))}}else{c.push(a)}if(b.suffix){c.push(b.suffix)}return c.join("")},numberShorts:{c:function(a,b,c){return this.standardNumberFormat(b,{prefix:"$",seperator:",",seperateAt:3,places:isNaN(c)?2:c})},d:function(a,b,c){return this.standardNumberFormat(b,{places:0,pad:c})},e:function(a,b,c){return b.toExponential(isNaN(c)?6:c).toString().toUpperCase()},f:function(a,b,c){return this.standardNumberFormat(b,{places:isNaN(c)?2:c})},g:function(a,b,c){var d,e=isNaN(c),f=b.toExponential(c).toString(),g=f.match(/[\-+]\d+$/);f=parseInt(g[0],10);if(f>-5&&(e||f<c)){d=e?b.toString():b.toPrecision(c)}else{d=b.toExponential(e?1:Math.max(c-1,0))}return d.toString().toUpperCase()},n:function(a,b,c){return this.standardNumberFormat(b,{seperator:",",seperateAt:3,places:isNaN(c)?2:c})},r:function(a,b,c){return b.toString()},x:function(a,b,c){var e=b>0?"":"-",f;b=Math.abs(b.toString(16));if(isNaN(b)){f=b}else{f=e+d.pad(b,"0",c||0,-1)}return f}},date:{dd:function(a){return a.getDate()},ddd:function(a){return this.daysShort[a.getDay()]},dddd:function(a){return this.days[a.getDay()]},hh:function(a){var b=a.getHours();if(b>12){b-=12}return b},HH:function(a){return a.getHours()},mm:function(a){return a.getMinutes()},MM:function(a){return a.getMonth()+1},MMM:function(a){return this.monthsShort[a.getMonth()]},MMMM:function(a){return this.months[a.getMonth()]},ss:function(a){return a.getSeconds()},tt:function(a){return a.getHours()>11?"PM":"AM"},yy:function(a){return a.getFullYear().toString().substring(2)},yyyy:function(a){return a.getFullYear()},zz:function(a){var b=a.getTimezoneOffset(),c=(b>0?"-":"")+d.pad(Math.abs(Math.floor(b/60)),"0",2,-1).toString();return c},zzz:function(a){var b=a.getTimezoneOffset(),c=(b>0?"-":"")+d.pad(Math.abs(Math.floor(b/60)),"0",2,-1).toString()+":"+d.pad(b%60,"0",2,-1);return c}},dateShorts:{d:"dd/MM/yyyy",D:"MMMM dd, yyyy",t:"hh:mm tt",T:"hh:mm:ss tt",f:"MMMM dd, yyyy hh:mm tt",F:"MMMM dd, yyyy hh:mm:ss tt",g:"dd/MM/yyyy hh:mm tt",G:"dd/MM/yyyy hh:mm:ss tt",M:"MMMM dd",r:"ddd, dd MMM yyyy hh:mm:ss GMT",s:"yyyy-MM-ddThh:mm:ss",u:"yyyy-MM-dd hh:mm:ssZ",U:"MMMM dd,yyyy hh:mm:ss tt",Y:"MMMM, yyyy"},days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};a.prototype.dateNames=function(){return d.getProperties(a.prototype.date,"length desc")}();a.prototype.numberShortRegex=function(){var b=d.getProperties(a.prototype.numberShorts,"length desc");return new RegExp("^(["+b.join("")+"])(\\d+)?$","i")}();b=function(b,c){var e=b,f=[],g=[],h=0,i,j,k,l,m,n;if(!d.isArray(c)){c=d.makeArray(arguments).slice(1)}if(e.indexOf("{{")===-1&&e.indexOf("}}")===-1){i=/\{(\d+)(,-?\d+)?(:.*?)?\}/gi;for(j=i.exec(e);j!==null;j=i.exec(e)){g.push({length:j[0].length,index:j[1],padding:j[2]!==undefined?parseInt(j[2].substring(1),10):0,format:j[3]!==undefined?j[3].substring(1):undefined,value:c[j[1]],paramAt:j.index})}}else{i=/^(\d+)(,-?\d+)?(:.*?)?$/gi;m=0;while(m>-1){k=e.indexOf("{",m);while(k!==-1&&e.substring(k,k+2)==="{{"){k=e.indexOf("{",k+2)}l=e.indexOf("}",m);while(l!==-1&&e.substring(l,l+2)==="}}"){l=e.indexOf("}",l+2)}if(k!==-1&&l!==-1){j=e.substring(k+1,l);j=i.exec(j);g.push({match:j[0].length+2,index:j[1],padding:j[2]!==undefined?parseInt(j[2].substring(1),10):0,format:j[3]!==undefined?j[3].substring(1):undefined,value:c[j[1]],paramAt:k})}m=e.indexOf("{",l)}}for(m=0;m<g.length;m+=1){n=g[m];if(n.paramAt>h){f.push(e.substring(h,n.paramAt));h=n.paramAt}if(n.format&&(n.value instanceof Date||typeof n.value==="number")){n.value=(new a).format(n.format,n.value)}n.value=d.pad(n.value," ",n.padding,n.padding);f.push(n.value);h+=n.length}if(h<e.length){f.push(e.substring(h,e.length))}f=f.join("");return f};c={format:b,formatValue:function(b,c){return(new a).format(b,c)}};return c};c=b();a={asPrototype:true,asGlobal:"formatter"};if(typeof formatConfig!=="undefined"&&formatConfig.hasOwnProperty){d.extend(a,formatConfig)}if(a.asPrototype){String.prototype.format=function(){var a=d.makeArray(arguments);return c.format(this,a)};Number.prototype.format=function(a){return c.formatValue(a,this)};Date.prototype.format=function(a){return c.formatValue(a,this)}}if(typeof a.asGlobal==="string"){window[a.asGlobal]=c}if(typeof define==="function"&&define.amd){define("jsformatter",function(){return c})}else if(typeof module!==undefined&&typeof module.exports){module.exports=c;this._=c}})()